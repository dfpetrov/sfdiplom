{% extends 'appcourses/manage/base.html' %}
{% load static %}
{% block section_body %}
    <div class="page-section bg-white border-bottom-2 mt-0 pt-4">
        <div class="container page__container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h4>{{ form.title.label }}</h4>
                    {{ form.title }}
                    {% if model == 'course' or model == 'quiz' %}
                        <h4 class="mt-3">{{ form.overview.label }}</h4>
                        {{ form.overview }}
                    {% endif %}
                    {% if model == 'question' %}
                        <h4 class="mt-3">{{ form.text.label }}</h4>
                        {{ form.text }}
                    {% endif %}
                    {% if model == 'lesson' %}
                        <h4 class="mt-3">{{ form.quiz.label }}</h4>
                        {{ form.quiz }}
                    {% endif %}
                    <h4 class="mt-3">{{ form.description.label }}</h4>
                    {{ form.description }}
                    {% if model == 'course' %}
                        <h4 class="my-3">{{ form.profit.label }}</h4>
                        {{ form.profit }}
                    {% endif %}
                    {% if model == 'course' or model == 'quiz' %}
                        <h4 class="my-3">Аватар</h4>
                        {{ form.avatar }}
                    {% endif %}
                </div>
                <div class="col-md-4">
                    <div class="card m-0">
                        <div class="card-header text-center">
                            <form method="post" id="form" class="needs-validation" novalidate
                                  enctype="multipart/form-data">
                                {% csrf_token %}
                                <input form="form" type="button" class="btn btn-accent btn-lg"
                                       value="Сохранить" name="btnSave" id="btnSave">
                            </form>
                        </div>
                        <div class="list-group list-group-flush">
                            <div class="list-group-item d-flex">
                                {% if not active %}
                                    <span class="flex text-info"><strong>Драфт</strong></span>
                                    <i class="material-icons text-muted">check</i>
                                {% else %}
                                    <span class="flex text-muted">Драфт</span>
                                {% endif %}
                            </div>
                            <div class="list-group-item d-flex"
                                 {% if active %}style="background-color: #f0f8ff;"{% endif %}>
                                {% if active %}
                                    <span class="flex text-danger"><strong>Опубликован</strong></span>
                                    <i class="material-icons text-danger">check</i>
                                {% else %}
                                    <span class="flex text-muted">Опубликован</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% if not creation %}
                        <div class="card my-3">
                            <div class="card-body">
                                <form method="post" action="{{ public_url }}">
                                    {% csrf_token %}
                                    <input type="submit" class="btn btn-outline-primary btn-lg btn-block"
                                           value="{% if active %}Снять с публикации{% else %}Опубликовать{% endif %}">
                                </form>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="container page__container page-section">
        <div class="row">
            <div class="col-md-8">
                <div class="row">
                    <div class="col-12">
                        <div class="mb-heading d-flex align-items-center">
                            <h4 class="flex mb-0">
                                {% if model == 'course' %}
                                    Модули
                                {% elif model == 'module' %}
                                    Уроки
                                {% elif model == 'lesson' %}
                                    Контент
                                {% elif model == 'quiz' %}
                                    Вопросы
                                {% elif model == 'question' %}
                                    {% if question.type == 'c' %}
                                        Значения пропущенных полей
                                    {% else %}
                                        Варианты ответа
                                    {% endif %}
                                {% endif %}
                            </h4>
                        </div>
                        <div class="card my-4">
                            <div class="card-body">
                                {% if model != 'question' or question.type != 'c' %}
                                <button type="button" class="btn btn-outline-primary mb-3" value="Добавить"
                                        name="btnAddContent" id="btnAddContent">
                                    Добавить
                                    {% if model == 'course' %}
                                        модуль
                                    {% elif model == 'module' %}
                                        урок
                                    {% elif model == 'lesson' %}
                                        контент
                                    {% elif model == 'quiz' %}
                                        вопрос
                                    {% elif model == 'question' %}
                                        {% if question.type == 'c' %}
                                            значение поля
                                        {% else %}
                                            вариант
                                        {% endif %}
                                    {% endif %}
                                    <i class="material-icons">add</i>
                                </button>
                                {% endif %}
                                <div class="nestable" id="nestable-handles-primary">
                                    <ul id="content_list" class="list-group list-group-fit nestable-list-plain mb-0">
                                        {% for content in contents %}
                                            <li class="list-group-item nestable-item" name="content"
                                                id="listContent_{{ forloop.counter }}"
                                                style="{% if content.active %} background-color: #f0f8ff; {% else %} background-color: #dcdcdc; {% endif %}">
                                                <div class="media align-items-center">
                                                    <div class="media-left">
                                                        <a href="#" class="btn btn-default nestable-handle">
                                                            <i class="material-icons">menu</i>
                                                        </a>
                                                    </div>
                                                    <div class="media-body">
                                                        <input type="text" value="{{ content.id }}"
                                                               id="contentId_{{ forloop.counter }}" hidden>
                                                        <span name="contentTitle"
                                                              id="contentTitle_{{ forloop.counter }}">
                                        {% if model == 'lesson' %}
                                            {{ content.item.title }}
                                        {% else %}
                                            {{ content.title }}
                                        {% endif %}
                                    </span>
                                                        {% if model == 'module' or model == 'quiz' %}
                                                            <small class="badge badge-pill badge-light my-2">
                                                                {{ content.get_type_display }}
                                                            </small>
                                                        {% endif %}
                                                        {% if model == 'lesson' %}
                                                            <small class="badge badge-pill badge-light my-2">
                                                                {{ content.get_content_type_display }}
                                                            </small>
                                                        {% endif %}
                                                        <div class="d-block">
                                                            {% if content.active %}
                                                                {% if model == 'question' %}
                                                                    <span class="badge badge-success"
                                                                          id="contentBadgeId_{{ forloop.counter }}">правильный</span>
                                                                {% else %}
                                                                    <span class="badge badge-success"
                                                                          id="contentBadgeId_{{ forloop.counter }}">активен</span>
                                                                {% endif %}
                                                            {% else %}
                                                                {% if model == 'question' %}
                                                                    <span class="badge badge-secondary"
                                                                          id="contentBadgeId_{{ forloop.counter }}">не правильный</span>
                                                                {% else %}
                                                                    <span class="badge badge-secondary"
                                                                          id="contentBadgeId_{{ forloop.counter }}">не активен</span>
                                                                {% endif %}
                                                            {% endif %}
                                                        </div>
                                                        {% if model == 'question' %}
                                                            <input type="text" hidden
                                                                   value="{% if content.active %}1{% else %}0{% endif %}"
                                                                   id="contentTypeId_{{ forloop.counter }}">
                                                        {% else %}
                                                            <input type="text" hidden
                                                                   value="{{ content.get_type_display }}"
                                                                   id="contentTypeId_{{ forloop.counter }}">
                                                        {% endif %}
                                                    </div>
                                                    <div class="media-right text-right">
                                                        <div style="width:100px">
                                                            {% if model == 'question' %}
                                                                {% if question.type != 'c' %}
                                                                <button type="button" class="btn btn-primary btn-sm"
                                                                        value="Редактировать" name="btnEditContent"
                                                                        id="btnEditContent_{{ forloop.counter }}"
                                                                        title="Изменить">
                                                                    <i class="material-icons">edit</i>
                                                                </button>
                                                                <button type="button" class="btn btn-danger btn-sm"
                                                                        value="Удалить" name="btnDelContent"
                                                                        id="btnDelContent_{{ forloop.counter }}"
                                                                        title="Удалить">
                                                                    <i class="material-icons">delete</i>
                                                                </button>
                                                                {% endif %}
                                                            {% else %}
                                                                <a href="{{ content.get_manage_url }}"
                                                                   class="btn btn-primary btn-sm"
                                                                   title="Изменить">
                                                                    <i class="material-icons">edit</i>
                                                                </a>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                        {% endfor %}

                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% if model == 'question' and question.type == 'c' %}
                    <div class="row">
                        <div class="col-12">
                            <div class="mb-2 d-flex align-items-center">
                                <h4 class="flex mb-0">Код к вопросу</h4>
                            </div>
                            <span class="text-muted d-block">blank start: <span class="text-info">{{ blank_trigger_start }}</span></span>
                            <span class="text-muted d-block">blank end: <span class="text-info">{{ blank_trigger_end }}</span></span>
                            <div class="mt-2">
                            {{ form.code }}
                            </div>
                            {% if always_false %}
                                <div class="card my-4">
                                    <div id="toolbar">
                                        <button id="custom-block-blank">
                                            <i class="material-icons font-size-20pt text-info">space_bar</i>
                                        </button>
                                    </div>
                                    <div id="editor"></div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-12">
                            <div class="flex mb-2">
                                <label class="form-label" for="expected_result">Ожидаемый результат</label><br>
                                <div class="custom-control custom-checkbox-toggle custom-control-inline mr-1">
                                    <input {% if need_expected_result %}checked=""{% endif %} type="checkbox" id="expected_result" class="custom-control-input">
                                    <label class="custom-control-label" for="expected_result">Yes</label>
                                </div>
                                <label class="form-label mb-0" for="expected_result">Yes</label>
                            </div>
                            {{ form.expected_result }}
                            {% if always_false %}
                                <div class="card my-4" id="expected_result_editor">
                                    <div id="editor2"></div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                {% endif %}
            </div>
            <div class="col-md-4">
                <div class="mb-heading d-flex align-items-center">
                    <h4 class="flex mb-0">Свойства</h4>
                </div>
                <div class="card my-4">
                    <div class="card-body">
                        {% if model == 'module' %}
                            <div class="form-group">
                                <label>Курс</label>
                                <a href="{{ course.get_manage_url }}" class="d-block text-info">{{ course }}</a>
                            </div>
                            <div class="form-group">
                                <label>{{ form.need_review.label }}</label>
                                {{ form.need_review }}
                            </div>
                        {% endif %}
                        {% if model == 'quiz' and type_lesson %}
                            <div class="form-group">
                                <label>Курс</label>
                                <a href="{{ course.get_manage_url }}" class="d-block text-info">{{ course }}</a>
                                <label>Модуль</label>
                                <a href="{{ module.get_manage_url }}" class="d-block text-info">{{ module }}</a>
                                <label>Урок</label>
                                <a href="{{ lesson.get_manage_url }}" class="d-block text-info">{{ lesson }}</a>
                            </div>
                        {% endif %}
                        {% if model == 'lesson' %}
                            <div class="form-group">
                                <label>Курс</label>
                                <a href="{{ module.course.get_manage_url }}"
                                   class="d-block text-info">{{ module.course }}</a>
                            </div>
                            <div class="form-group">
                                <label>Модуль</label>
                                <a href="{{ module.get_manage_url }}" class="d-block text-info">{{ module }}</a>
                            </div>
                        {% endif %}
                        {% if model == 'lesson' or model == 'quiz' %}
                            <div class="form-group">
                                <label>{{ form.type.label }}</label>
                                {{ form.type }}
                            </div>
                        {% endif %}
                        {% if model == 'quiz' %}
                            <div class="form-group">
                                <label>{{ form.time_type.label }}</label>
                                {{ form.time_type }}
                            </div>
                            <div class="form-group">
                                <label>{{ form.duration.label }}</label>
                                {{ form.duration }}
                            </div>
                        {% endif %}
                        {% if model == 'course' or model == 'quiz' %}
                            <div class="form-group">
                                <label>Раздел</label>
                                {{ form.subject }}
                            </div>
                            <div class="form-group">
                                <label>Язык</label>
                                {{ form.language }}
                            </div>
                            {% if model == 'course' or model == 'quiz' %}
                                <div class="form-group">
                                    <label>Уровень</label>
                                    {{ form.level }}
                                </div>
                            {% endif %}
                            {% if model == 'quiz'%}
                                <div class="form-group">
                                    <label>{{ form.index_avatar.label }}</label>
                                    {{ form.index_avatar }}
                                </div>
                            {% endif %}
                            <div class="form-group">
                                <label>Создатель</label>
                                <input type="text" class="form-control form-control-lg" readonly value="{{ user }}">
                                <input type="text" name="owner" form="form" readonly hidden value="{{ user.id }}">
                            </div>
                        {% endif %}
                        {% if not creation %}
                            {% if model != 'question' %}
                                <div class="form-group">
                                    <label>Slug</label>
                                    {{ form.slug }}
                                </div>
                            {% endif %}
                        {% endif %}
                        {% if model == 'module' or model == 'lesson' %}
                            <div class="form-group">
                                <label>Order</label>
                                {{ form.order }}
                            </div>
                        {% endif %}
                        {% if model == 'question' %}
                            <div class="form-group">
                                <label>Тест</label>
                                <a href="{{ question.quiz.get_manage_url }}"
                                   class="d-block text-info">{{ question.quiz }}</a>
                            </div>
                            {% if question.quiz.type == 'l' %}
                                <div class="form-group">
                                    <label>Урок</label>
                                    <a href="{{ question.quiz.lesson.get_manage_url }}"
                                       class="d-block text-info">{{ question.quiz.lesson.module.course }}/{{ question.quiz.lesson }}</a>
                                </div>
                            {% endif %}
                            <div class="form-group">
                                <label>Тип вопроса</label>
                                {{ form.type }}
                            </div>
                            <div class="form-group">
                                <label>{{ form.duration.label }}</label>
                                {{ form.duration }}
                            </div>
                            <div class="form-group">
                                <label>Баллы</label>
                                {{ form.score }}
                            </div>
                            <div class="form-group">
                                <label>Создатель</label>
                                <input type="text" class="form-control form-control-lg" readonly
                                       value="{{ question.owner }}">
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block section_js %}
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
    <script src="{% static 'vendor/jquery.nestable.js' %}"></script>
    <script src="{% static 'js/nestable.js' %}"></script>
    {% if model == 'question' and question.type == 'c' %}
        {% include '_quill_js.html' %}
    {% endif %}
    <script>

        {% if model == 'question' and question.type == 'c' and always_false %}
            let container = document.getElementById('editor');

            let toolbarOptions = [
                ['code-block'],
                [{
                    'script': 'sub'
                }, {
                    'script': 'super'
                }],
                [{
                    'indent': '-1'
                }, {
                    'indent': '+1'
                }],
                [{
                    'color': []
                }, {
                    'background': []
                }],
                ['clean']
            ];
            let options = {
                modules: {
                    syntax: false,
                    toolbar: toolbarOptions
                },
                placeholder: 'Код к вопросу...',
                theme: 'snow'
            };
            let editor = new Quill(container, options);
            let code_HTML_JSON = '{{ code_HTML_JSON|escapejs }}'
            try {
                editor.setContents(JSON.parse(code_HTML_JSON))
            } catch (error) {
            }

            let container2 = document.getElementById('editor2');
            let options2 = {
                modules: {
                    syntax: false,
                    toolbar: toolbarOptions
                },
                placeholder: 'Ожидаемый результат...',
                theme: 'snow'
            };
            let editor2 = new Quill(container2, options2);
            let expected_result_HTML_JSON = '{{ expected_result_HTML_JSON|escapejs }}'
            try {
                editor2.setContents(JSON.parse(expected_result_HTML_JSON))
            } catch (error) {
            }

            let customButton = document.getElementById('custom-block-blank')
            customButton.addEventListener('click', function () {
                let range = editor.getSelection()
                if (range) {
                    if (range.length == 0) {
                        console.log('Область не выделена. Нужно выделить область.', range.index);
                    } else {
                        editor.insertText(range.index + range.length, '{{ blank_trigger_end }}');
                        editor.insertText(range.index, '{{ blank_trigger_start }}');
                        //
                        // var h2 = Array.prototype.slice.call(document.querySelectorAll("*"));
                        //var matches = h2.filter(item => item.style.color == "red;");
                        //matches = Array.from(h2).find(v => v.style.color == 'red');
                        //console.log(matches)
                        // var newDiv = document.createElement('div')
                        // newDiv.innerHTML = "<h1>Привет!</h1>"
                        // matches[0].appendChild(newDiv);

                    }
                }
            })

        {% endif %}

        let expectedResult = document.getElementById('expected_result')
        if (expectedResult != undefined){
            expectedResult.addEventListener('change', changeHandler)
            {#let expectedResultEditor = document.getElementById('expected_result_editor')#}
            let expectedResultEditor = document.getElementById('id_expected_result')
            if (expectedResultEditor != undefined){
                if(expectedResult.checked){
                    expectedResultEditor.classList.remove('d-none')
                }
                else{
                    expectedResultEditor.classList.add('d-none')
                }
            }
        }

        function changeHandler(){
            {#let expectedResultEditor = document.getElementById('expected_result_editor')#}
            let expectedResultEditor = document.getElementById('id_expected_result')
            if (expectedResultEditor != undefined){
                if(this.checked){
                    expectedResultEditor.classList.remove('d-none')
                }
                else{
                    expectedResultEditor.classList.add('d-none')
                }
            }
        }

        btnSave.onclick = function () {

            formIsValid = true
            if (formIsValid) {

                const swalWithBootstrapButtons = Swal.mixin({
                    customClass: {
                        confirmButton: 'btn btn-success',
                        cancelButton: 'btn btn-danger'
                    },
                    buttonsStyling: false
                })

                swalWithBootstrapButtons.fire({
                    title: 'Сохранить изменения?',
                    text: 'объект будет сохранен',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Да, сохранить',
                    cancelButtonText: 'Нет, не надо',
                    reverseButtons: true
                }).then((result) => {
                    if (result.value) {

                        let formData = new FormData(document.forms.form)

                        let contentList = document.getElementsByName('contentTitle')
                        let contents = []
                        var order = 1

                        contentList.forEach(element => {
                            let contentInputID = element.id.replace('contentTitle_',
                                'contentId_')
                            let contentTypeInputID = element.id.replace('contentTitle_',
                                'contentTypeId_')
                            let listContentID = contentInputID.replace(
                                'contentId_',
                                'listContent_')
                            let inputContent = document.getElementById(contentInputID)
                            let inputContentType = document.getElementById(contentTypeInputID)
                            let listContent = document.getElementById(listContentID)
                            if (inputContentType != null) {
                                var c_type = inputContentType.value
                            } else {
                                var c_type = ''
                            }
                            if (listContent.hidden) {
                                var contentData = {
                                    title: element.innerText,
                                    id: inputContent.value,
                                    type: c_type,
                                    remove: true,
                                    order: order
                                }
                            } else {
                                var contentData = {
                                    title: element.innerText,
                                    id: inputContent.value,
                                    type: c_type,
                                    remove: false,
                                    order: order
                                }
                            }
                            order += 1
                            contents.push(contentData)
                        });

                        formData.append("contents", JSON.stringify(contents));

                        {% if model == 'question' and question.type == 'c' %}

                            {% if always_false %}
                                let textFormat = editor.getContents();
                                formData.append("code_format", JSON.stringify(textFormat));
                                let textFormat2 = editor2.getContents();
                                formData.append("expected_result_format", JSON.stringify(textFormat2));
                            {% endif %}

                            expectedResult = document.getElementById('expected_result')
                            if (expectedResult != undefined){
                                if (expectedResult.checked) {
                                    formData.append("need_expected_result", '1')
                                }else{
                                    formData.append("need_expected_result", '0')
                                }
                            }
                        {% endif %}

                        let postUrl = "{{ post_url }}"
                        var xhr = new XMLHttpRequest()
                        xhr.open("POST", postUrl)
                        xhr.send(formData)
                        xhr.onloadend = function () {
                            if (xhr.status == 200) {

                                let response = JSON.parse(xhr.response)

                                if (response.response !== 'error') {
                                    window.location = response.response
                                } else {
                                    let alert_errors = document.getElementById('alert_errors')
                                    try {
                                        alert_errors.innerHTML = response.errors
                                        alert_errors.classList.remove('d-none')
                                    } catch (error) {
                                    }

                                    //console.log(response.errors)
                                }

                            } else {
                                if (xhr.status == 403) {
                                    alert('Нет прав на редактирование объекта')
                                }
                            }

                        }

                    } else if (
                        result.dismiss === Swal.DismissReason.cancel
                    ) {
                        // swalWithBootstrapButtons.fire(
                        //     'Отмена',
                        //     'можешь продолжить редактирование',
                        //     'error'
                        // )
                    }
                })

            }
        }

        {% if not creation %}

            {% if model != 'question' or question.type != 'c' %}
            btnAddContent.onclick = function () {

                Swal.mixin({
                    input: 'text',
                    confirmButtonText: 'Next &rarr;',
                    showCancelButton: true,
                    {% if model == 'course' %}
                        progressSteps: ['1']
                    {% elif model == 'module' %}
                        progressSteps: ['1', '2']
                    {% elif model == 'lesson' %}
                        progressSteps: ['1', '2']
                    {% elif model == 'quiz' %}
                        progressSteps: ['1', '2']
                    {% elif model == 'question' %}
                        {% if question.type == 'c' %}
                            progressSteps: ['1']
                        {% else %}
                            progressSteps: ['1', '2']
                        {% endif %}
                    {% endif %}
                }).queue([
                    {% if model == 'course' %}
                        {
                            title: 'Название модуля',
                            text: 'создание нового модуля',
                            inputPlaceholder: 'Например: Типы данных в Python'
                        },
                    {% elif model == 'module' %}
                        {
                            title: 'Название урока',
                            text: 'создание нового урока',
                            inputPlaceholder: 'Например: функция print'
                        },
                        {
                            title: 'Тип урока',
                            text: '1 - урок; 2 - тест',
                            inputPlaceholder: 'тип: 1 или 2'
                        },
                    {% elif model == 'lesson' %}
                        {
                            title: 'Название контента',
                            text: 'создание нового контента',
                            inputPlaceholder: 'Например: основная часть урока или абзац про console.log'
                        },
                        {
                            title: 'Тип контента',
                            text: '1 - текст; 2 - тест, 3 - видео, 4 - файл',
                            inputPlaceholder: 'Тип контента: 1/2/3 или 4'
                        },
                    {% elif model == 'quiz' %}
                        {
                            title: 'Название вопроса',
                            text: 'создание нового вопроса',
                            inputPlaceholder: 'Например: сколько будет 2+2?'
                        },
                        {
                            title: 'Тип вопроса',
                            text: '1 - одиночный выбор; 2 - множественный выбор, 3 - код',
                            inputPlaceholder: 'Тип вопроса: 1/2 или 3'
                        },
                    {% elif model == 'question' %}
                        {% if question.type == 'c' %}
                            {
                                title: 'Значение пропущенного поля',
                                inputPlaceholder: 'значение поля...'
                            },
                        {% else %}
                            {
                                title: 'Вариант ответа',
                                text: 'создание нового варианта ответа',
                                inputPlaceholder: 'текст варианта или значение пропущенного поля'
                            },
                            {
                                title: 'Тип варианта',
                                text: '1 - правильный; 0 - не правильный',
                                inputPlaceholder: 'Тип ответа: 1 или 0'
                            },
                        {% endif %}
                    {% endif %}
                ]).then((result) => {
                    if (result.value) {

                        let contentTitle = result.value[0]
                        let contentTypeColor = '#dcdcdc'
                        let contentTypeBadge = 'badge-secondary'

                        {% if model == 'module' %}
                            let contentType = result.value[1]
                            let contentTypeText = ''

                            switch (contentType) {
                                case '1':
                                    contentTypeText = 'урок';
                                    break;
                                case '2':
                                    contentTypeText = 'тест';
                                    break;
                                default:
                                    contentType = '1'
                                    contentTypeText = 'урок';
                            }
                        {% endif %}

                        {% if model == 'lesson' %}
                            let contentType = result.value[1]
                            let contentTypeText = ''

                            switch (contentType) {
                                case '1':
                                    contentTypeText = 'Текст';
                                    break;
                                case '2':
                                    contentTypeText = 'Тест';
                                    break;
                                case '3':
                                    contentTypeText = 'Видео';
                                    break;
                                case '4':
                                    contentTypeText = 'Файл';
                                    break;
                                default:
                                    contentTypeText = 'Текст';
                            }
                        {% endif %}

                        {% if model == 'quiz' %}
                            let contentType = result.value[1]
                            let contentTypeText = ''

                            switch (contentType) {
                                case '1':
                                    contentTypeText = 'single';
                                    break;
                                case '2':
                                    contentTypeText = 'multiple';
                                    break;
                                case '3':
                                    contentTypeText = 'code';
                                    break;
                                default:
                                    contentTypeText = 'code';
                            }
                        {% endif %}

                        {% if model == 'question' %}
                            {% if question.type == 'c' %}
                                let contentType = '1'
                                let contentTypeText = 'значение поля'
                                contentTypeBadge = 'badge-success'
                                contentTypeColor = '#f0f8ff'
                            {% else %}
                                let contentType = result.value[1]
                                let contentTypeText = ''
                                contentTypeBadge = 'badge-secondary'
                                contentTypeColor = '#dcdcdc'

                                switch (contentType) {
                                    case '1':
                                        contentTypeText = 'правильный';
                                        contentTypeBadge = 'badge-success'
                                        contentTypeColor = '#f0f8ff'
                                        break;
                                    case '0':
                                        contentTypeText = 'не правильный';
                                        contentTypeBadge = 'badge-secondary'
                                        break;
                                    default:
                                        contentTypeText = 'не правильный';
                                        contentTypeBadge = 'badge-secondary'
                                }
                            {% endif %}
                        {% endif %}

                        let contentCount = 'new' + (document.getElementsByName('content').length + 1)

                        if (contentTitle) {

                            content_list.innerHTML += `
                    <li class="list-group-item nestable-item" name="content"
                    id="listContent_` + contentCount + `" style="background-color: ` + contentTypeColor + `">
                    <div class="media align-items-center">
                        <div class="media-left">
                            <a href="#" class="btn btn-default nestable-handle"><i
                                    class="material-icons">menu</i></a>
                        </div>
                        <div class="media-body">
                            <input type="text" value="` + contentCount + `"
                                id="contentId_` + contentCount + `" hidden>
                            <span name="contentTitle"
                                id="contentTitle_` + contentCount + `">` + contentTitle + `</span>
                            {% if model == 'module' or model == 'lesson' or model == 'quiz' %}
                            <small class="badge badge-pill badge-light my-2">` + contentTypeText + `</small>
                            {% endif %}
                            <div class="d-block">
                            {% if model == 'question' %}
                                <span class="badge ` + contentTypeBadge + `" id="contentBadgeId_` + contentCount + `">`
                                + contentTypeText + `</span>
                            {% else %}
                                <span class="badge badge-secondary" id="contentBadgeId_` + contentCount + `">не активен</span>
                            {% endif %}
                            </div>
                            {% if model == 'module' or model == 'lesson' or model == 'quiz' or model == 'question' %}
                            <input type="text" hidden value="` + contentType + `"
                                                   id="contentTypeId_` + contentCount + `">
                            {% endif %}
                        </div>
                        <div class="media-right text-right">
                            <div style="width:100px">
                                <button type="button" class="btn btn-primary btn-sm"
                                    value="Редактировать" name="btnEditContent"
                                    id="btnEditContent_` + contentCount + `"
                                    title="Изменить"><i class="material-icons">edit</i>
                                </button>
                                <button type="button" class="btn btn-danger btn-sm"
                                    value="Удалить" name="btnDelContent"
                                    id="btnDelContent_` + contentCount + `"
                                    title="Удалить">
                                    <i class="material-icons">delete</i>
                                </button>
                            </div>
                        </div>
                    </div>
                </li>`
                        }

                    }
                })
            }

            function delegate(el, evt, sel, handler) {
                el.addEventListener(evt, function (event) {
                    var t = event.target;
                    while (t && t !== this) {
                        if (t.name == sel) {
                            handler.call(t, event);
                        }
                        t = t.parentNode;
                    }
                });
            }

            delegate(document, "click", "btnEditContent", function (event) {
                (async () => {

                    contentId = this.id.replace("btnEditContent", "contentTitle")
                    let content = document.getElementById(contentId)

                    contentTypeId = this.id.replace("btnEditContent", "contentTypeId")
                    let contentType = document.getElementById(contentTypeId)

                    contentBadgeId = this.id.replace("btnEditContent", "contentBadgeId")
                    let contentBadge = document.getElementById(contentBadgeId)

                    contentListItemId = this.id.replace("btnEditContent", "listContent")
                    let contentListItem = document.getElementById(contentListItemId)

                    {% if model == 'question' and question.type != 'c'%}

                        const {value: formValues} = await Swal.fire({
                            title: 'Редактирование',
                            html:
                                '<label>текст варианта</label>' +
                                '<input id="swal-input1" class="swal2-input" value="' + content.innerText + '">' +
                                '<label>корректность: 1 - правильный; 0 - нет</label>' +
                                '<input id="swal-input2" class="swal2-input" value="' + contentType.value + '">',
                            focusConfirm: false,
                            preConfirm: () => {
                                return [
                                    document.getElementById('swal-input1').value,
                                    document.getElementById('swal-input2').value
                                ]
                            }
                        })

                        if (formValues) {
                            content.innerText = formValues[0]
                            if (formValues[1] == '1') {
                                contentType.value = 1
                                contentBadge.innerText = 'правильный'
                                contentBadge.classList.remove('badge-secondary')
                                contentBadge.classList.add('badge-success')
                                contentListItem.style.backgroundColor = '#f0f8ff'
                            } else {
                                contentType.value = 0
                                contentBadge.innerText = 'не правильный'
                                contentBadge.classList.add('badge-secondary')
                                contentBadge.classList.remove('badge-success')
                                contentListItem.style.backgroundColor = '#dcdcdc'
                            }
                        }

                    {% else %}
                        const {
                            value: contentTitle
                        } = await Swal.fire({
                            title: 'Редактирование',
                            input: 'text',
                            showCancelButton: true,
                            inputValue: content.innerText
                        })

                        if (contentTitle) {
                            content.innerText = contentTitle
                        }
                    {% endif %}

                })()

            });

            delegate(document, "click", "btnDelContent", function (event) {
                Swal.fire({
                    title: 'Удалить?',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#dd3333',
                    cancelButtonText: 'Нет',
                    confirmButtonText: 'Да'
                }).then((result) => {
                    if (result.value) {
                        (async () => {
                            listContentId = this.id.replace("btnDelContent", "listContent")
                            let content = document.getElementById(listContentId)
                            content.hidden = true
                        })()
                    }
                })
            })
            {% endif %}

        {% endif %}

    </script>
{% endblock %}